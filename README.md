# Реализация классов транзакции блокчейна

Эта программа демонстрирует реализацию классов для описания транзакции в гипотетическом блокчейне на языке Python. Транзакция включает входы, выходы и цифровую подпись с использованием RSA. Код разделен на модули для лучшей организации.

## Особенности

* **Модульность**: Код разделен на модули (`keys`, `transaction_input`, `transaction_output`, `transaction`).
* **Класс `TransactionInput`**: Представляет вход транзакции, ссылающийся на выход предыдущей транзакции.
* **Класс `TransactionOutput`**: Представляет выход транзакции, указывающий получателя (его публичный ключ PEM) и сумму.
* **Класс `Transaction`**: Основной класс, агрегирующий входы, выходы, временную метку и цифровую подпись.
  * ID транзакции (`tx_id`) вычисляется как хэш от данных транзакции и ее подписи (если она есть).
  * Поддерживает подпись транзакции с использованием приватного RSA ключа.
  * Поддерживает верификацию подписи с использованием публичного RSA ключа.
  * Методы для сериализации (`to_dict`) и десериализации (`from_dict`).
  * Входы и выходы автоматически сортируются для обеспечения детерминизма при хэшировании.
* **Механизм подписи**: Используется асимметричный алгоритм RSA (с PSS padding) из библиотеки `cryptography`.
  * Функции для генерации ключей, сериализации и десериализации ключей в формат PEM.
  * Подписывается хэш данных транзакции (входы, выходы, timestamp).
* **Восстановление цепочки (теоретически)**: Формат данных позволяет отслеживать происхождение средств через ссылки `TransactionInput` на `previous_tx_id` и `output_index`.
* **Тестирование**: Включены подробные модульные тесты с использованием стандартной библиотеки `unittest`.

## Требования

* Python 3.7+
* Зависимости, указанные в `requirements.txt`

## Сборка и запуск

1. **Клонируйте репозиторий или создайте файлы** согласно описанной структуре.

2. **Создайте и активируйте виртуальное окружение (рекомендуется):**

```bash
python -m venv venv
# Для Windows
venv\Scripts\activate
# Для macOS/Linux
source venv/bin/activate
```

3. **Установите зависимости:**

Из корневой директории проекта:

```bash
pip install -r requirements.txt
```

4. **Запустите основной демонстрационный скрипт:**

Из корневой директории проекта:

```bash
python main.py
```

Скрипт `main.py` продемонстрирует создание ключей, coinbase-транзакции, обычной транзакции, ее подпись, верификацию, сериализацию и десериализацию.

5. **Запустите тесты:**

Из корневой директории проекта:

```bash
python -m unittest discover tests
```

Или для конкретного файла тестов:

```bash
python -m unittest tests.test_transaction
```

## Пояснения к некоторым решениям

* **ID транзакции (`tx_id`)**:
  1. При инициализации `tx_id` = `SHA256(данные_транзакции_без_подписи)`. Этот хэш также является данными, которые подписываются.
  2. После вызова `sign()`, `tx_id` обновляется на `SHA256(SHA256(данные_транзакции_без_подписи) + hex(подпись))`.
* **Детерминизм**: Для консистентного хэширования входы и выходы транзакции сортируются, а JSON-сериализация для хэширования использует `sort_keys=True`.
* **Coinbase транзакции**: В данной реализации coinbase транзакции (без входов) не требуют подписи со стороны "пользователя". Метод `verify_signature` для них возвращает `True`, если подпись отсутствует. В реальной системе они обычно подписываются ключом майнера.
* **Восстановление из словаря (`from_dict`)**: `tx_id` при восстановлении всегда пересчитывается на основе данных объекта, чтобы обеспечить его корректность, даже если `tx_id` в исходном словаре был неверным.
